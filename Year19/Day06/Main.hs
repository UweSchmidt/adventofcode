-- solution for
-- http://adventofcode.com/2019/day/6


module Main where

import Util.Main1 (main12)
import Control.Arrow ((***))
import Data.Set      (Set)
import Data.Relation (Rel')

import qualified Data.Set      as S
import qualified Data.Relation as R

-- ----------------------------------------

main :: IO ()
main = main12 "2019-06"
       inp captcha1
       inp captcha2

captcha1 :: String -> String
captcha1 = toString . solve1 . fromString

captcha2 :: String -> String
captcha2 = toString . solve2 . fromString

-- --------------------

type Input  = [Orbit]
type Output = Int

type Obj    = String
type ObjSet = Set Obj
type Orbit  = (Obj, Obj)
type Orbits = Rel' Obj

orbGen :: Orbits -> [ObjSet]
orbGen obs = iterate (R.applyS obs) (S.singleton "COM")

noOfOrbits :: Orbits -> Int
noOfOrbits obs =
  sum . zipWith f [0 ..] . takeWhile (not . S.null) . orbGen $ obs
  where
    f :: Int -> ObjSet -> Int
    f n ps = n * S.size ps

pathToCOM :: Orbits -> Obj -> [Obj]
pathToCOM obs = reverse . go
  where
    go o
      | Just o' <- S.lookupMin os1 = o' : go o'
      | otherwise                  =  []
      where
        os1 = R.apply obs o

transPathLen :: Orbits -> Obj -> Obj -> Int
transPathLen obs src dst =
  uncurry (+) . (length *** length) $ transPath obs src dst

transPath :: Orbits -> Obj -> Obj -> ([Obj], [Obj])
transPath obs src dst =
  shorten sp dp
  where
    sp = pathToCOM obs src
    dp = pathToCOM obs dst

    shorten (x : xs) (y : ys)
      | x == y    = shorten xs ys
    shorten xs ys = (xs, ys)

-- --------------------

-- consistency check of orbit relation
-- rel must represent a tree: single root "COM" and
-- at most a single predecessor
--
-- consistency check takes most of the time

toOrbits :: Input -> Orbits
toOrbits os
  | singleRoot obs
    &&
    isTree obs     = obs
  | otherwise      = error "inconsistent input"
  where
    obs  = R.fromList os

-- every o in rng obs has at most 1 predecessor
isTree :: Orbits -> Bool
isTree =
  R.foldrS elem1 True . R.invert
  where
    elem1 _x ps res = S.size ps == 1 && res


singleRoot :: Orbits -> Bool
singleRoot obs =
  S.size com == 1
  ||
  S.findMin com == "COM"
  where
    com = R.roots obs

reachableSeq :: Orbits -> ObjSet -> [ObjSet]
reachableSeq obs = iterate gen
  where
    gen os = R.applyS obs os `S.difference` os

distance :: Orbits -> Obj -> Obj -> Maybe Int
distance obs src dst = lookup $ gens
  where
    gens = zip [0..] $ reachableSeq obs $ S.singleton src

    lookup :: [(Int, ObjSet)] -> Maybe Int
    lookup ((n, os) : gs)
      | S.null os = Nothing
      | dst `S.member` os = Just n
      | otherwise = lookup gs

-- --------------------

solve1 :: Input -> Output
solve1 = noOfOrbits . toOrbits

-- find paths from YOU and SAN to COM
-- remove common prefixes and add both length
-- works with inverted relation

solve2 :: Input -> Output
solve2 os = transPathLen obs "YOU" "SAN"
  where
    obs = R.invert . toOrbits $ os

-- find shortest path length from YOU to SAN
-- works with symmetric relation (undirected graph)

solve2' :: Input -> Output
solve2' os = maybe (-1) (\ x -> x - 2) $ distance obs "YOU" "SAN"
  where
    obs = R.symmetric . toOrbits $ os

fromString :: String -> Input
fromString =
  map toOrbit
  . lines
  where
    toOrbit :: String -> Orbit
    toOrbit xs = (x, y)
      where
        (x, xs') = span (/= ')') xs
        y        = drop 1 xs'

toString :: Output -> String
toString = show

-- ----------------------------------------

ex1 :: String
ex1 = unlines
  [ "COM)B"
  , "B)C"
  , "C)D"
  , "D)E"
  , "E)F"
  , "B)G"
  , "G)H"
  , "D)I"
  , "E)J"
  , "J)K"
  , "K)L"
  ]

rs1 :: Int
rs1 = 42

test1 :: Bool
test1 = (solve1 $ fromString ex1) == rs1

ex2 :: String
ex2 = unlines
  [ "COM)B"
  , "B)C"
  , "C)D"
  , "D)E"
  , "E)F"
  , "B)G"
  , "G)H"
  , "D)I"
  , "E)J"
  , "J)K"
  , "K)L"
  , "K)YOU"
  , "I)SAN"
  ]

rs2 :: Int
rs2 = 4

test2 :: Bool
test2 = (solve2 $ fromString ex2) == rs2


inp :: String
inp = "797)67Y\nW32)48L\nJ31)N9K\nQQ3)NVL\nMP6)JBY\n8T3)H27\nDRK)THF\nBSN)7MD\nZ2G)VRX\nCVV)XDC\nWVW)SV6\nD3H)QMG\n9BM)NTH\n4T7)FQS\nF58)D1Q\nCR7)B7L\n4W8)T9Z\n5SB)5JB\nDRJ)YQD\n76X)X1Z\nWC9)LNG\n52C)W7J\n9ZS)KM7\n3RW)C8R\n7RQ)TJW\nHVN)ZNQ\nSQK)CBT\nGWC)N76\nKBQ)W44\nQD5)RVQ\nSQF)N3K\nRZ1)B2R\nTB5)34W\nJ56)CQD\n34Y)HLX\nDTM)TD4\n2RF)SQV\nGJT)TFD\nCNK)88B\nPJD)GD8\n4V8)FQN\nHKH)6RS\n7T4)2JT\nDBM)DMQ\n59X)137\nHK7)B62\nD34)K7Z\nRR2)M74\nQ13)FC5\n1F1)8XJ\nK1L)QZ9\nT73)4VT\nZ7S)59X\n1MQ)GB6\nBJT)4BZ\nWW8)DT2\nJYL)6SH\nR2K)WC9\n21H)4ZD\nZ7Z)QWZ\nF8N)LRZ\nQZ9)9TD\n3DP)VDT\nGZK)ZGF\nG3P)KLZ\n7ZM)G3P\n3VX)P4H\n7T4)LNV\nVVV)Q99\nBYX)87K\n4C1)9XS\nSB3)4SV\nFYV)JQ4\nHQ4)ZMR\nK7Z)LKT\nTQM)BBH\n9V5)PJD\n7VB)H6L\n66X)FDY\nNT9)17R\nK9Z)T26\n1BX)VRN\nTJD)5ST\nQWZ)5CT\nMD6)GJT\nTT1)W3Y\nB2R)444\nMB8)NFN\nFB1)4T3\nV3Y)DJ7\n2GQ)265\nSLV)G3B\nTHF)DC1\nHRR)LV1\nQZ7)ZR5\nVGS)ZCG\nCRY)3L3\n3N2)CZ4\nY1B)3WF\nYK2)W5C\nX15)8ZW\n92C)3PV\n7Z8)Y4B\nPWF)NX2\nGPR)QVR\nTDL)TRM\nW4X)8TH\n23H)6KK\n4X2)TXV\nHQ9)52C\nLRG)RWM\n38N)YVB\nW7F)BSM\n3VC)FQC\nPS7)Z7Z\n2YX)QSG\n9PB)4KF\nVRX)K9Z\nTRM)R2K\nWYB)NRD\nHJ2)5LM\nZRJ)WWL\n7TW)WZR\nCBX)7S2\nV4N)FSN\n17B)88D\nF91)LWV\nL54)9G4\n592)YC1\nJ24)9KW\nGNP)Y7T\nKDP)22T\nZNQ)QFZ\n8NW)MKC\nVSJ)NTD\n137)VQS\nYB3)MP6\n38W)DLK\nCJJ)683\n59N)GHZ\nW3Y)P9Y\n733)V2Q\nWX6)4GM\nRRP)HG8\nL6L)YZZ\nQRW)YZX\n1FD)RMT\nHSJ)5V9\nRVQ)1KY\n9K7)72H\nV6S)75V\nNB1)SDT\nJ5N)4R6\nQD7)1SR\nJ6W)3FL\n2GQ)FQM\nJ5N)2K9\n2B4)R23\n4L5)QXX\n7J4)42R\n6X7)H2X\n8D1)LH7\n592)J4Y\n6CM)4GW\nR6V)KSD\nFDL)NKS\nP4H)8RZ\n46M)L1N\nM64)M4K\n6K3)KZ9\nFH8)1SS\nDJ7)BMS\nMG1)RQ9\nZRH)5G1\nTMT)VQG\n11V)W7N\nZM5)QHZ\nDSL)8GB\nYK5)38P\nC1Y)YYJ\nH61)8N2\nT7W)VVJ\nTHR)M7F\nXXH)3H3\nTVX)595\nB2B)KBF\n76Z)DGL\n9PR)X23\nST7)G8Q\n1FP)FH8\nQ5F)7V2\nXKP)2VC\n47G)1ZG\nQXX)8XD\nMNG)KNF\nRF3)XD8\nK4F)PLX\n66D)LXG\nTQW)5SP\nSBR)ZFT\nNMH)8W7\nN79)YBM\nBK8)JY9\nNKS)H8K\nLQ5)SNS\nTVR)N6T\nQXP)M92\nYMD)HM8\nT84)25S\nQ6K)M3K\nR23)MZM\nCTB)B9Z\nDT2)718\n9ZD)GXG\nKKV)N5K\nGBK)TKG\nTRG)GMW\nKFY)PLY\nLSP)RG9\nZ31)MBP\nLXF)LFF\n3JC)MS6\nCRY)6ZK\n67H)Z6Y\nB9Z)674\nTWJ)DW2\n1PR)4WW\nX1J)QZR\n128)FLG\nGTT)75S\n67Y)HNK\nH2L)ZRX\n9V6)RF3\nGRX)TDC\nWJR)68N\n129)QJ4\nFY1)PWF\nF5D)RQM\nS7K)PVL\n88B)C23\nYV9)136\n5C8)X6V\nLDQ)1FD\nN55)WYB\nWZB)ZT8\nSYH)QVB\nFWZ)SFX\nZVJ)VXP\nL5V)J31\n8ZW)4HG\n49B)J24\n6LC)Z98\nG83)4V8\nBGX)J9B\n6XF)MQJ\n54P)BTC\n83Z)KZP\nBZZ)J9P\nRL5)QXQ\nYMQ)HH4\n3XQ)64P\n3BG)SBJ\nX7P)N8Y\n3HN)L4S\nT1P)H61\nZJR)ZZR\n1SH)JY7\nKTB)LYF\nZLF)BXG\nG3B)BRS\n8JV)46M\nKDX)TP4\nDPC)T8P\nVRQ)G56\n2JZ)M64\nYY2)1J2\nVSJ)G7W\nSJ3)L68\n19W)SMN\nKJX)GNP\n7S3)RP1\nVCS)MKK\n8C6)7TR\nNY3)2LY\n9N2)GVQ\n9Y1)K9W\nPLX)V6S\n38P)QNP\nV2D)J4Q\nTGL)NMG\n2N2)NXX\nZBW)G5C\n88Y)QTV\nNPD)B9Y\nNFR)HHP\n9Z9)Y49\nNTH)LG9\nRG9)HHS\nY3P)D7W\nD38)4JL\nMF5)XGZ\n4BB)DJJ\n1XF)BZ4\nF4Q)MHQ\n7QN)FPZ\n98T)DXP\nMLJ)DMR\nZZC)7P2\n5G1)7T4\nJ9B)VR4\nW7K)1LP\n8Z2)4K2\nN1N)DS1\nT73)TQW\nRQV)HCS\nT8P)6XS\nCNK)9WG\n3RP)43B\nS2K)Z2G\nZ3H)P8G\nBZ4)QVP\nW7J)BN5\nZNJ)91T\n6V7)CLD\n6SH)6L9\nXLQ)YBC\nBWN)6RL\nDRK)NBG\n5ST)LR7\nBPM)DNV\n3H7)WYV\nWNF)BS9\nFY1)6K9\n3T2)3P4\nB45)S1Q\nBKX)9ZD\nY7T)9PR\nBRS)92N\nQLQ)75L\nXMQ)XTF\nN8Y)LSJ\n4Q1)2MG\nNT9)NRL\n7NT)F18\nNRD)CFJ\nMDW)QXC\nQMG)LCN\nLSJ)L24\n44J)V5Y\n186)18R\n91T)RM1\nP4B)XVT\nJN4)128\nJXZ)6PZ\nQ36)3RP\n6K1)T2C\n3S8)3VX\n42R)QSD\n3WF)66X\nLB2)XXH\nG3Y)SB3\n44G)J99\nHPK)2X5\n7NH)HGJ\n2W6)HTC\nHM8)FS4\nXFD)9FK\n643)L1R\n3SQ)VB6\n8BQ)N5L\n2X5)J3R\n1ZS)8LF\n21Z)SLK\nYL7)FQH\nRKK)DMZ\nTNY)F96\nY2F)FRV\nMN7)BZZ\n38X)KWN\n75F)8WP\nZR5)N7W\nF65)2VB\n5PT)84N\nF9Y)HRR\nSVL)RXH\nRB6)NFR\nQTV)8CV\n58Z)BWN\nFQN)BK8\nWXC)MLY\n683)HF6\nT5X)6X6\nBC5)WZB\nJ2H)SQF\nDBM)LJQ\nFQS)SWH\nBFC)SLV\n45B)7F8\nZ12)6DS\nDP1)3T2\nSLK)BBN\n34Q)6V7\nX66)DCJ\nV1V)X6C\nMR9)Z9T\nPMF)VP9\nVCL)GNN\nB7L)KQ2\n95C)F58\n2RF)YJJ\nKNF)5X4\nGJT)YZJ\nN9K)XTN\nT84)HZW\nTJN)6QJ\nTB5)Z7W\nYKV)YMQ\nW6T)1CV\n1G3)5ZB\nLXG)3MK\nYJN)TTD\n2Z7)KJN\nHHS)KKV\nKQ2)D3W\nM32)3SK\n528)49L\nCVH)LB6\nQSY)C6J\nVQS)KFY\nVPJ)95Q\n2MG)GCK\nB2N)9QV\n6N5)5FX\nF25)QJB\n92Z)7QN\n7XN)G62\nWQ8)61N\nX8F)HG1\n6Z4)3YQ\nMHQ)SAN\nXR9)5XJ\n891)H43\nVTD)1BJ\n48L)MV7\nW7W)BQT\nS9W)42J\n7P2)ZV9\nTW7)DXK\nCBG)2JK\n7H8)KRG\nGDW)W4X\nG8X)2NW\nJ99)Y5T\nVP9)83G\nD17)DKJ\n1YF)W9J\nRSH)T43\n4SV)6V6\nM7D)QRQ\n3WC)CJJ\n45R)45B\nWFN)21H\n4HG)8C6\nNFN)BC5\nXWF)BWG\nNHR)ST7\nH83)NXB\n3SK)7GB\nZKW)D34\nVDT)1SH\n33V)N7F\nM8Z)4W8\nXPD)WXC\nFRY)Z2V\nJB4)WR2\nYPF)8T3\nC8R)LRK\nV8L)WQ1\n28R)Q7Y\nC52)Z18\nCBY)GLF\nPXR)1F1\n4XM)CFG\nJ8G)V11\nRVN)9V6\nFZQ)B4V\n775)3HN\n1B2)X42\nVD7)6GY\n5WS)91M\nJJ2)3RW\n3RG)8PX\nH4W)KHD\nB4Z)J56\n8XP)ZHJ\nFZ4)6DZ\n3QM)1XJ\nKQD)WDC\nBNV)87P\nGHZ)B2J\nJ4Y)PXR\nBMM)LVJ\n4JK)WZN\nTTD)KNL\nTW2)9JZ\n6KK)DPC\nRZV)FK8\n3DR)VSR\nPDP)76Z\nN7H)X7P\nJ4L)7VB\n2HT)DSL\nMV7)ZL3\nQ7Y)FHP\n7BM)2HT\n4KF)FX7\nB62)DHN\nFJ4)775\nZ1V)XFQ\nN6T)7MV\n136)F4M\nFBW)FGV\nW5G)Q7R\n2G5)21B\nF76)LLY\nVCX)WJB\nBN5)B2N\nZVF)9HQ\nBMJ)D17\n1Q1)Y6J\n6TV)MR9\n9FQ)1MQ\nFC4)VCT\nV2C)YDS\n8N2)T7W\nN5K)RY7\nYPH)WGN\nRPY)TVY\n6BQ)JJF\n1SZ)KDP\n1WL)DQW\nZXR)BT3\nMS6)JN4\n4ZD)DBM\n3RL)BM4\n4DK)SVL\nYZ4)XR1\n5R1)FMZ\n8W7)JS1\nKWN)GZK\nSR5)L9J\nJX6)X5V\nYBC)3S8\nH48)BTY\nFL4)6WC\nGB6)285\n64P)B4Z\nHCS)LK1\nQ5F)R6V\nJDC)HKH\nPWR)916\nRDW)TRJ\nV11)9L8\nHXY)9VS\nRP1)CZD\nB9Y)891\nP1G)FRZ\nQTV)B92\nVB6)LYJ\n3FL)7PW\nQLM)L54\nLYQ)6LC\nY5Q)MD6\nKQ2)KJX\nGQG)1K8\nSY7)WK9\n77W)K1H\n65Z)RFV\nH54)4P4\n95Q)KTB\nVMB)DZS\nF3C)1N5\nT26)7WW\nMSL)CWB\nQF5)6LN\nTWH)MGK\n73Z)7KR\nVPP)LR8\n129)CBX\nG8Q)L5V\n9V7)RLB\nB2X)YPR\nT2D)M3M\nTT1)4QD\n89C)JCX\nT7S)7QJ\n6WC)SXQ\nZ3H)YPM\nMBP)7Z8\nD3W)G83\nQXX)74K\nSSB)V2D\nQVM)ZBL\nWZ1)Z6G\nD8J)GQG\n9CF)F1C\nYDP)TWH\nFZ9)T3M\nZTQ)V9X\nRX7)7F1\nL3H)6NF\nBSM)TBV\nZ2V)D6G\nYS7)W32\nLWV)7ZB\nPSP)YJR\n49C)DWM\n88D)3SZ\nLX9)G2Z\n46D)GKR\nZ7W)1PR\nPWK)NY3\nWDC)Z1V\nZGF)PBN\nW28)HX3\n5WQ)49B\nDYK)B5C\n4R6)HK3\nHZ2)N7H\nMN8)G4Y\nSJW)B2X\n4M5)6QW\nYVC)PDW\nD1Q)C97\n3SZ)7FW\nN6M)MF5\nP53)XWC\nG46)RDW\nF6H)G9N\nXTF)BNV\n6LC)K8B\n2XV)813\n7TR)J26\nHC4)K38\n9QV)VG8\nF7Y)58Z\nN7W)V4N\nYZX)35W\nVCJ)1SN\nR85)1FP\nWHT)681\nQCJ)RHP\n2T5)ZTX\nVXP)XKP\nDVZ)2VX\nRDF)6FN\nDLR)RXK\nM66)F8N\nBQD)TW1\n9L8)2BL\n4T5)M36\n8FJ)3PK\nMLF)7TW\nLR8)VZJ\nTMH)P2Z\n8TH)LFP\nFB6)66D\n3P2)4T5\nBGZ)K4F\n75V)F4Q\nTP4)8K6\n4JL)KGH\nN5L)LFC\nF5D)WN4\nRMT)T5C\n1JB)XSJ\nMDB)WDX\nY4B)765\n1BY)MDW\nKYQ)48R\nKDD)6K3\nYZ2)517\nDC1)V5V\nJS1)6C9\nFVR)3L7\nCCQ)HQ9\nLB6)JPM\nSWH)W28\nWVM)K8N\nL7T)GPF\n4X5)98T\nJ1V)97M\nXHZ)FZQ\nJ2L)CQ1\nZ9T)W7F\n3XQ)F25\nXYS)M66\nPFM)92C\n144)F91\n7ZB)PFM\nGPK)HXY\nBBN)MLJ\n1KY)3QM\n7FW)8BQ\nNP8)N2C\nCLY)QLQ\nHN5)VD7\n1CV)H7D\nQCJ)TDZ\nG9N)HLN\nWYK)8H7\nNRL)QXS\nXMF)WHQ\nSQV)2G5\nYQM)VZX\nNMX)SR5\nT4P)6VG\n3SQ)S47\n1BJ)Q36\nQXS)51X\nHX3)KGJ\n28V)GGC\n2VC)6BL\n4Q8)RVX\nCKW)GTT\nJX4)XCB\nNDH)Z8W\nHJ2)S2K\nS6Z)NMX\nN76)6TV\nRLD)Q8V\nR1Q)K7V\nFRV)RQK\nFJF)RLS\nKBF)SWF\nVJP)Y2F\nLW6)PMF\n7MD)67H\n456)S3D\nDW4)23D\nKVT)CVH\nNGC)1YF\nFX7)JX4\n674)HBV\n77G)7H8\nMZ6)528\nNX2)WGD\nTZR)CLZ\nYY7)4TQ\nK8B)GR9\nS1Z)WF2\nH5F)CKS\nW3R)J1V\nDTH)28R\n9SK)7NH\nQ8V)X9B\nWJB)4FK\n5SP)VJP\n3ZL)8Z2\nC6J)H85\nYR7)4JK\nYS7)RVN\nBPM)H83\nQ1Y)ZWH\n4JM)561\nMVM)6X7\nT6Q)TW2\nTPT)47G\nQVB)144\nVSR)H48\nGPS)FJF\nRFB)T4B\nVP7)3C9\n2D8)FZ4\nDWM)Y61\nYJN)C52\n1JB)ZG5\n2K9)J7F\n3MK)4XM\nYB3)PS7\nCOM)WV2\nPDW)T1P\n4YP)Q13\nBTC)ZBW\n9FS)37V\n87P)XP2\n7F1)RTN\nHKR)ZKW\nNHL)2XV\nPP4)CBG\nSDT)9CF\nHLN)GBK\nY21)GPS\nH42)FJ4\nFFZ)DDD\nSF7)YZ2\nLP4)VSK\nFK8)W5G\nRFF)2FM\n517)FDL\n9FK)TW7\n83H)S1M\nS4T)D8G\n9TZ)89C\nG7W)VMB\n4TQ)V7H\nJGP)Z95\nV9X)VCS\n8P7)DN2\nWKZ)95C\nL9J)Z8M\nM36)FHD\nBBH)T3G\nXHZ)DP1\nVZJ)39J\nFVR)YV9\nZ95)XK9\nD5Y)HTZ\n8JH)ZXS\nB9D)VHJ\nYQD)XPD\n9Z8)ZRT\n285)X66\nF94)D5Y\nC23)G3T\n7SR)PWR\nLK1)K79\nX42)8JV\n3K2)LSP\nDHH)QF5\nB92)H2L\n7QJ)MPR\nFYH)BYX\nQCT)PFC\nVQG)PQ8\nKNL)4SC\nQJB)YOU\nYKH)YY2\nS1M)T92\n6PW)11V\nHMT)CQY\nFHD)MTV\nZ6G)PVR\n4Q1)6N5\nN3M)38W\nVCT)CCQ\n9KW)BMF\nQSG)4C1\nJ7T)GST\nFVN)TY8\nX6C)4YN\nKRG)Q1Y\nCDD)7FS\nKDM)K1L\nNXB)QR4\nXFQ)FZN\n1T4)KYQ\nQVR)34Q\nW6S)TSK\nXLD)YKH\n75R)TH8\nT9Z)5NG\nC97)YJF\nPSZ)33Z\nGNN)R49\n36J)N3H\nMYL)N1Z\nWPP)RHG\n2VX)T6Q\nXP2)DG9\nS21)Z1Q\nNMG)YDV\nSLV)BGZ\n931)KQD\n1DB)XGB\nSXQ)WCX\nK59)XBB\nTXV)ZVF\nDG9)Y3N\nH27)3ZZ\nXY8)ZZC\nQ7R)V8L\nW9J)WFN\n8H7)J1X\nQJ4)DXJ\nGST)Q6K\nYDS)JXP\nGMW)83M\nTFD)P3N\nXTN)PKR\n9HQ)5H6\nBTB)685\n3PN)D3H\n6NT)F3C\nJXP)77W\nD8G)XHY\nQZ9)L2J\n75L)SQK\nXWC)8YX\nL1N)GS2\nJQ8)31Y\nTZQ)FVK\nDN2)YPH\nDW2)8NW\nRRQ)2T5\nS81)DT5\nS3X)V3Y\nXBB)FVR\nBFV)9DQ\n9PR)Z3Z\n92N)PLM\nB5C)NZR\n3C9)LJ5\nCQ1)HPK\nLR7)BGX\n37V)D61\nLRK)SP9\nJY1)HQ4\nRQM)WKZ\n8X9)TJQ\nDS4)KWB\nLG9)JXZ\nHG8)MN8\nKGJ)BYK\n2JK)FMR\nWB1)GB9\nWGD)TT1\nZ3Z)RTL\nCDQ)6PW\n8V8)2HD\nCCC)W7K\nYMQ)1WL\nGRY)WB1\n4QK)DS4\nFQH)SSB\nZ8W)648\nGPD)Q5F\nZBL)LCK\n6RL)ZTM\n7MV)6Z4\nQSY)B9D\nN55)SVN\nG62)1B2\n91R)Q1L\nG3P)GX2\nPVL)1YW\nJ9B)JJ2\nTNS)PHY\nMGK)XZG\nRFV)3XQ\n1XJ)23H\nG3T)Z5H\n3RK)T1W\nT92)MXC\nXDC)HG6\nWJQ)PRY\nXCB)D8Z\nK4R)K32\nXYS)46D\nRK4)931\n7FS)442\nRQ9)YV4\nKFV)RDF\nYC1)2B4\nCBT)WHT\nJGZ)RTB\nC19)HYY\nRM1)PDP\nSFX)RK4\nV5V)JYL\nRXK)T57\n17R)3DR\nCQL)JK6\nSP9)WVM\nZG5)T7N\nQD7)YL7\nZFT)3RG\nPLM)SH8\nRP6)VPP\n12T)K4R\nG9F)KFV\nMGG)72P\n85L)DPB\nGWP)L6L\nNHD)WYK\nXK8)9ND\nT5X)ZXY\n6QJ)8X9\n4MY)RP6\nWN4)W9L\n7CW)JH8\n1JN)R7V\n7KR)Q1G\nYHT)5WR\nGLP)FHT\n59X)TLM\n8LS)RKB\n4MY)LKV\nNQW)VPJ\nJ7F)R1Q\nWWL)77G\nLH7)YVC\nLR2)SVZ\n826)2Z7\nC8R)HJ2\n8WP)GFJ\nX23)FB6\nRM1)76X\n1Z6)BMJ\n1FR)51P\nLCK)VFT\nZL3)75R\nKWB)L7T\n6ZW)826\nNZR)3K2\nFQC)VHL\nYPM)YPJ\n2FM)CNL\n4TQ)HTP\nWGD)36J\nPBN)9FQ\nYVC)C2P\nS49)YJN\nQLX)SZC\nZ8W)BFC\n3ZZ)8D1\nWJV)JDP\nZ7W)QPK\nVZL)9VZ\nKLZ)K5Q\nSWS)TPT\nR68)VFM\nSXM)J4L\nL71)BTB\n8GB)6D5\n9WG)P6P\nJ52)SYH\nD6G)T25\nTBV)F9Y\nR3Y)NHL\n5XF)S84\nVTZ)Z31\nHZW)XMT\nDGL)W6S\n7TN)QJN\n2JT)WJQ\nXSJ)9XN\nYG4)X15\nJY7)DTM\nB9Z)MGG\nYJJ)Y8G\nB4V)R6F\nTFF)TDL\nTNS)FYH\nFDY)CCM\nHG6)H2H\nN5L)Z2N\nFWZ)V1Z\nCFG)GYM\n23D)BJT\nBGD)CLY\nGXG)9FS\nZWH)T73\nJ24)D4X\n88N)BGJ\nLH7)K5Y\n3MC)7S3\nTJW)Z7S\nZK7)695\n1DM)19W\n51P)DVX\nN1Z)1SZ\nJPM)3N2\n6D5)M32\nVVJ)KDM\nFHP)19S\nWCX)VZL\n4FK)5XF\nDZQ)SWS\nQRQ)J52\nRHP)ZHT\n5RR)92Z\n3P4)D5N\n1XJ)38N\nYFB)C19\n1MT)S6T\n8K5)QD8\nW86)NGC\nZV9)8FJ\nGYM)GDP\n7LS)HMT\nLCN)S7K\nK32)7RQ\nNFR)S6Z\nQ6K)CNK\nLYF)RRP\n8XJ)R6G\nN1Y)DZQ\nPQ8)H78\nHYY)J2H\n8MB)5R1\nYDV)4GG\n8YX)V62\n84V)46L\nLNV)KVC\n6X6)TMH\nBPL)33V\n6V6)YMM\nJZJ)QWP\n4T3)VSJ\nDNH)JX6\nZFT)VCX\nKSD)YMD\nHYR)F64\nGLF)7Q6\nFPT)84V\nR6G)YK5\nNNT)H4W\nTJD)WKD\nRWZ)VMM\nNLW)85L\n4YN)SQR\n8N2)9ZS\nN3K)YHT\n2S1)SYL\nCCM)5MS\nGVQ)HC4\nVM5)W3Q\nWQ1)FWZ\nRQK)GZM\nHNK)8DX\nD6J)GRY\nTZQ)RZV\nWHQ)SVY\nWVM)3DP\nZ7Z)PKM\nC2K)N1Y\nZ2N)9HB\nCRZ)4YM\nH78)MB8\n8RH)8LW\nNBG)2BG\nXSW)TMT\n561)LRG\n1N5)4M5\nFLW)YBZ\n6RP)3QH\nM92)R58\nCZ7)RDL\nFGV)ZPV\nRXF)CDQ\n9XS)W7W\n9VZ)4X2\nVRX)WPP\nLYJ)VXH\n681)YSC\nPFC)5CQ\n7G7)X8F\nT57)FY1\nZ8Z)BKX\nZ5P)YDP\nCQD)T1D\n8HF)BSN\nYZJ)HVJ\nKRL)N55\n4KR)4DK\nP2D)KVT\nRLC)YPF\nGX2)4JM\nV2Q)7F5\nFQM)L2G\nSGD)WC5\nHTC)SJG\nF1C)GDW\nWDX)G21\nHBV)CVV\n7F5)1Z6\nLNK)HFD\nJB4)DFP\n7S2)85B\nS1Z)HKR\n2LY)LX9\nT2C)DGK\nHLX)Z6L\n4FM)NDH\nTRJ)TQM\n49L)JY1\nMPR)3T6\nCWM)9SK\n52C)9BX\nJBY)DVW\nV9C)DLR\nZHT)86L\nMBH)NG2\n7SR)G4D\n35M)MYL\nNTD)QCT\n2TX)1P3\n8RZ)8VK\nWYP)N2S\n7Z8)2RF\nSJG)29X\n7WW)GDT\nVRN)QZ7\n7LG)YK2\n765)XLD\nP3N)TRG\nGCK)RSH\nTLM)GPK\nM79)4FX\nXGB)RL5\nRXH)PKH\nYHB)LR2\n265)1G3\nMCG)NHR\n3PV)BPM\nLM3)TFF\nY49)1BX\nGB9)W1Q\nGKR)45R\n2LF)CHQ\n595)X41\nW2G)7CW\nYB6)83Z\n8LF)2W6\nGJG)H42\nPKR)3Z6\nFLL)G7S\nWZS)ZFJ\nGB4)88N\n8BK)CQM\n9VS)W2G\n5CT)YYD\nG4Y)N79\nKJN)Y1T\nRY7)LBS\nK16)FLL\nYPF)LW6\nSBJ)CRY\n4DZ)186\n4GG)5WQ\nKDV)4DZ\nQ1L)H54\nR9Z)733\nYPJ)GLT\nLNP)WVW\nXPD)21Z\n9V2)HK7\n4WW)37W\n8K6)FBW\nR3Y)LM3\n5M2)VM5\nZNJ)DVZ\nDVH)1NW\nGLT)HM1\nSLK)PWK\n84N)6K1\nGS2)88Y\nK1H)GWP\n4GW)ZRJ\nDVX)PZG\nVSF)5GL\nWBS)4DV\n8XD)S49\nV6J)4T7\n75S)YKR\nGZM)BGD\nNKS)LKD\n29X)LYQ\nJY9)2YX\nHBY)73Z\nBMF)LP4\nT4B)KC2\n87K)5M2\nQZR)FLW\nGR9)KRL\nTXB)6NT\n4FK)4MY\nB31)2LX\nTG1)4YP\nBQT)LNK\nTW1)RB6\n3L7)T4P\nZ8Z)N3M\n6TF)CR7\nLFC)R33\n37W)1FL\nCQY)J5N\nS4G)VTD\nZT8)RZ1\n5CQ)1FR\nBXG)FB1\n9G4)BPL\nZCG)F65\nZZR)2NC\nWZR)59N\n6C9)V2C\nZFJ)P1G\nCWB)KYN\nSY4)R85\nDLK)9V2\n2LX)VGN\n5JB)GPR\nQHZ)9K7\nD8Z)2LF\n395)NB1\n1FL)FBF\n5MS)4XD\nHF6)49C\nJL7)YDQ\n33Z)TG1\nCXL)X8Y\nKYM)8XP\nRTB)54P\nLZ3)WJR\n6DZ)969\nFC5)XH7\nDKJ)MCG\nQCR)VCJ\nW32)QXP\n2XS)7LG\nZ6G)KDX\nH43)1SJ\nR7V)G7M\nYV4)8V8\nD4X)1Q1\nQSD)3KQ\nSFX)M6F\nDZ2)4DY\n6K9)1DB\nCZD)2TX\n3Z6)RRQ\n72H)3H7\n7BM)QRW\nP1G)NPF\n85B)71W\nFRV)MMC\n21B)5RR\nCSL)VCL\nXGZ)CDD\n2B4)V9C\nQD5)T2M\nVMM)456\nG56)S1Z\nNR6)C1N\nNXX)HMR\nH2H)XSW\nD7W)GPD\nJBY)ZNJ\nWKD)KDV\n7PN)MD2\nGDT)G6Q\nLV1)7XN\n3KQ)RHW\nSWF)XLQ\nYDS)FL4\n45R)Z8Z\nK4F)K59\nHLJ)QD5\n11H)MX8\nMKC)VH3\nG21)NT9\nQXQ)L6Q\nVJ2)GFS\nHWJ)P4B\nB33)3P2\nW28)2QR\nC1N)8LS\n9KW)PSZ\n74K)6ZT\nB23)WZ6\nPPG)GJG\nPKM)4QK\nBS9)T7S\nF96)39P\n444)RM5\nT6Q)BWD\nS7K)M7D\nYYD)M79\nD1P)116\n4DV)J6W\nJ7F)FRY\nSVY)TZQ\n8PX)1ZS\nQFZ)NKW\nFD8)YB6\nCLY)X6W\n1YW)RFB\n648)3MC\n7D7)8TJ\nDT5)B33\nT3M)5C8\n31Y)FYV\nT43)75F\nH46)RFF\n3BR)J8G\n7S7)WBS\nG9F)C39\n2QR)12T\nMKK)7LS\nD1P)RX1\nX8Y)CS3\n7PN)CRZ\nQMG)XNK\nYMD)3JC\nYSC)S21\nDKZ)VWQ\nC1Y)G9Y\nDS1)Z4P\nT2M)9BM\n38X)XMF\nMZM)DZ2\nDXK)YQQ\nHGJ)YZ4\nVCL)7BM\nZPV)SN4\n7J9)6XF\nQWP)RKK\nTSK)CQL\nBMS)TVX\nNPF)VJ2\nKC2)NP8\nMX8)YQM\nTH8)RLD\nKM7)F76\nZRT)XJR\nVWQ)V6J\nMKC)SY7\nWGN)HLJ\nCXL)4Q8\n1LP)8RH\nMQJ)KD7\n7R8)R9Z\n3H3)JL7\nY8G)LNP\n4VT)P51\n2NC)MLF\n12H)HVN\nHVJ)MN7\nSZC)7J4\n5X4)D1P\n29N)NMH\n8LW)L71\nYYJ)G46\nLDL)CQ3\nKHG)6MS\nRR2)83H\n35D)38X\nSV6)XMQ\nKHD)MSL\nFGB)XFD\nZS2)LXF\nDMQ)FZ9\nMMC)FGB\nJW7)34Y\nWGN)VRQ\nLRZ)TB5\n6NF)4FV\nDMR)9N2\n916)SY4\n83G)WJV\n65M)12H\n9HB)WSL\nL1R)5SB\nG9Y)1BT\nJ26)91R\nWR2)H46\n2RC)K16\nQJN)VVV\n4QD)G3Y\nXBV)35M\nQPK)RR2\nS72)T84\nQ2B)5PT\n39J)MBH\nVFM)QSY\nG2Z)KDD\nY94)ZS2\nMTV)NPB\nR49)B31\nRVX)TZR\nMD2)V1V\n9TD)MDB\nWYV)YFB\nFRZ)C2K\nDPB)CTJ\n5JB)M8Z\n4DY)WQ8\nKGH)WZS\n35W)3RK\n1SN)PSP\nVGN)5WS\nBR8)8JH\nN2Z)ZXR\nTJY)29N\n8JN)S81\n4FV)3Y3\nQFZ)F7Y\nH7D)FFZ\nTVY)BMM\n8VK)395\nN3H)X1J\n6RS)HQH\n42J)FCX\n6TF)R3Y\n4K2)7R8\nBGJ)2JZ\n7F8)G92\nBMS)6CM\nHTZ)ZM5\nHQH)8P7\nMXC)7LR\nM3K)YKV\n54P)TJD\nFS4)28V\n7PW)WNF\nHMR)SGC\nV5V)HBY\nRM5)Z12\nKZP)KCV\n4P4)VWV\nWZR)XYS\nRNC)9Z8\nQR4)JQ8\nWSL)7S7\nS81)DHH\nNGC)7SR\n6L9)8MB\nDNH)44J\nPVR)124\nXZG)4X5\nM6F)CB8\nQJB)CZ7\nDQW)XBV\nPKH)RX7\nGFS)7J9\nW7N)DVH\n96G)DQC\nBWG)W6T\n2BG)129\nHHP)SJW\nFGB)SBR\nX6W)XHZ\n5SB)MZ6\nL5G)65M\nWC5)1MT\n3T6)CTB\nYJF)JGZ\n124)LB2\nJDP)592\nWV2)4D6\nT7N)Y94\n1SJ)ZTQ\nCKS)KHG\n1SR)4L5\n6N5)3BR\n22T)BQD\nNBG)CSL\n1ZG)DYK\nP8G)DRK\nLKD)RPY\n7S3)9PB\nZTM)RNC\n3QH)Y21\nVXH)LDQ\nNVL)QD7\nTDC)TM4\nW5C)YHB\n19S)MS9\nMNM)SJ3\n8MT)XY8\n6J1)GWC\nT5C)KBQ\nDC1)MVM\nQXD)N8B\nLKT)F5D\nHM1)TNY\nDQC)S9W\nRTL)QGK\nJ1T)FPT\nCZ7)2N2\n674)FC4\nFMR)NLW\nTKG)1JN\n1P3)GLP\nHK3)VTZ\nRHW)PG9\nLJQ)7B2\n5ZB)7ZM\nLFP)PQW\nTY8)YS7\n4BZ)QLX\n9BX)TNS\nS84)3PN\nGGC)S4T\nL5G)WX6\n25S)JZJ\nWK9)L5G\nLBS)9V5\nK7V)8MT\n7Q6)G8X\n4GN)HXM\nVH3)XK8\nN8B)882\n83M)YG4\nP51)YR7\nCS3)YY7\nSVZ)N1N\nX5V)G9F\nG7M)GRX\n39P)16T\nYBM)JDC\nWDC)8K5\nHLN)W9F\nQVP)XR9\n442)VSF\nYJR)LZ3\n86L)6TF\nP2Z)LDL\nPQW)PPG\nCB8)1JB\nW9F)CHH\nVSK)RG1\nSXM)QCR\n969)WYR\n6VG)F69\nMLY)3VC\nRDL)ZRH\nX1Z)TWJ\n1BT)RXF\n4FX)T2D\nL2J)LB5\nVHJ)MNM\nY3N)3BG\nGD8)4KR\n8TJ)C79\nCFJ)QVM\n4YM)SXM\n71W)2S1\n16T)NR6\nD5N)PC7\nS47)2RW\n2Q3)QQ3\n6FN)9Y1\nPZG)6B3\nXD8)2D8\nC39)TJN\nWYR)HWJ\nHG1)RLC\nCQM)7G7\nWF2)NPD\nVWV)643\nJLZ)B2B\nZ5H)BFV\nLX9)1T4\nCBG)3ZL\n9HQ)8JN\nF18)Q7J\nF4M)W86\nQ7J)YHM\n6BQ)4FM\n8CV)ZN4\nYPR)NW2\nVFT)FDW\nDFP)JT7\nY6J)ZK7\nC2P)CBY\n3Y3)TVR\n97M)JLZ\nRG1)YB3\n1J2)DLX\nV7H)D6J\n6B3)8BK\nNW2)F94\nPLY)D38\nJ3R)WYP\n4GM)9TZ\nD34)44G\nQXC)B23\nL68)797\nHH4)1XF\nN2S)ZJR\nJJF)CXL\nL24)Z5P\nYHM)JB4\n5FX)DW4\n5WR)KYM\n1SS)QCJ\n9V5)RWZ\nZXY)FD8\nVHL)6JG\nRTN)Y5Q\nJGP)H5F\n2T5)7NT\nLLY)TWZ\nSYL)HSJ\nBK8)3NR\nVG8)D8J\nZ18)T5X\nG7S)N6M\n9JZ)BR8\nBM4)8HF\nDXP)7D7\nPG9)3SQ\nP9Y)J7T\n47G)TGL\n9BX)JGP\nHXM)7TN\nJQ4)LQ5\n6MS)VP7\n2BL)3WC\nT1W)WW8\nYDQ)NQW\n1FL)Z3H\nJCX)WHG\n6ZK)L3H\nDZS)TXB\nZ4P)6BQ\nY5T)9V7\n5WQ)HN5\nDGK)C1Y\nFSN)ZLF\n72P)DNH\n19S)K14\nQPK)FRL\n6QW)VGS\n5V9)2C7\nBYK)RQV\n1JN)XWF\n34W)6RP\nQFS)SF7\nY61)CKW\nR33)NNT\nMS9)4Q1\nM74)FVN\nRX1)S4G\n116)4BB\nYQQ)MC2\nZN4)1BY\nRLS)BBC\nB2J)11H\nP6P)F6H\nKD7)R9K\nFCV)ZVJ\nZTX)HZ2\nVMM)SGD\n5H6)Q2B\nL1R)9Z9\nH83)FCV\nF91)B45\nL4S)PP4\n2VB)R69\nYB6)4GN\n5ST)1DM\n3L3)J2L\nZRX)2RC\n5GL)S3X\n7LR)N2Z\n3RL)P2D\nZHJ)TJY\nDCJ)2XS\nPHY)96G\nMDB)QFS\nSH8)LZ7\nVSF)CCC\nXMT)35D\nYKR)GB4\nX41)Y3P\nMN8)2Q3\nLNG)NHD\nK8N)DTH\nH2X)J1T\n5LM)Y1B\nJT7)6J1\nVR4)P53\n813)JW7\nCNL)QXD\nPRY)MG1\nS3D)R68\nJGZ)PXX\n1NW)S72\nFYH)3RL\n48R)CWM\n2RW)6ZW\n6DS)MNG\nFD8)238\nFZN)HYR\nNHL)THR\nZ98)65Z\nTRM)QLM\nK38)W3R\n4D6)WZ1\nBWD)2GQ\nFRL)DKZ\nWZ6)HC9\nBBN)7PN\nDJJ)DRJ\n3YQ)17B\nKCV)YTH\n"

res1, res2 :: Output
res1 = 315757
res2 = 481

-- ----------------------------------------
